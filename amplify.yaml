version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        # 確実にNextが読むファイルを作る（上書き）
        - printf "FASTAPI_BASE_URL=%s\n" "$FASTAPI_BASE_URL" > .env.productions
    build:
      commands:
        - npm run build

  artifacts:
    baseDirectory: .next
    files:
      - '**/*'

  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*

  environment:
    variables:
      FASTAPI_BASE_URL: ${FASTAPI_BASE_URL}
